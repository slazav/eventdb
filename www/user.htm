<html>
<head>
  <LINK href="RESDIR/edb.css" rel="stylesheet" type="text/css">
  <script type="text/JavaScript" src="RESDIR/knockout-3.4.0.js"></script>
  <script type="text/JavaScript" src="RESDIR/edb.js"></script>
  <style>
    th {
      font-weight: normal;
      background-color: #D0F0FF;
    }
  </style>
</head>

<body onload="user_on_load()">

  <!-- Top menu, login/logout buttons -->
  <table width="100%" border=0 class="main_menu"><tr>
  <td class=hh width="0%"><a href="MAINHTM">Главная</a></td>
  <td class=hh width="0%"><a href="MAPHTM">Карта</a></td>
  <td class=hh width="0%"><a href="HELPHTM">Документация</a></td>
  <td class=hh align=right>
    <a href="USERHTM" data-bind="text:alias"></a>
    <input type=submit value="выйти" style="display:none"
       data-bind='visible: is_logged, click: logout'>
    <a style="display:none"
       data-bind='visible: !is_logged(), attr: {href: lgnz_url}'>войти</a>
  </td>
  </tr></table>
  <hr>

  <h4>Добро пожаловать!</h4>

  <!-- Change alias form -->
  <span data-bind="if: alias">
    <p>Ваше имя на этом сайте: <b data-bind="text: alias"></b>
    <img src="RESDIR/edit2.png" alt="редактировать"
         data-bind='click: sw_alias_form'>
    <br>Вы можете поменять имя, нажав на картинку справа от него.

    <form style="display: none"
        data-bind="visible: alias_form, submit: set_alias">
    <font size="-1"> Изменить имя:
    <input type="text" data-bind='value: new_alias'>
    <br>Имя может содержать от 2 до 20 символов:
        буквы, цифры, символы подчеркивания "_".
    <br>Имя не может совпадать с именем другого пользователя.
    </font>
    </form>
  </span>

  <!-- Accounts list -->
  <span data-bind="if: alias">
    <p>Вы можете заходить сюда со своих аккаунтов в соцсетях:
    <ul data-bind="foreach: faces"><li data-bind="html: html"></ul>
  </span>

  <!-- Join accounts form -->
  <span data-bind="if: alias">
    <p>Если вы хотите настроить вход с других аккаунтов, нажмите на картинку:
    <img src="RESDIR/edit2.png" alt="форма добавления аккаунтов"
         data-bind='click: sw_join_form'>

    <form style="display: none"
        data-bind="visible: join_form, submit: joinreq_add">
    <font size="-1">
    <p>Чтобы присоединить данный аккаунт к уже существующему
       пользователю, введите в следующей форме введите его имя.
    <br>Этому пользователю будет отправлен запрос на присоединение:
    <input type="text" data-bind='value: joinreq_name'>
       <font color="#800000" style="display:none"
             data-bind='visible: joinreq_done'>
        Запрос отправлен. </font>
    <p>После того, как запрос будет отправлен, перелогинтесь
       с помощью того аккаунта, к которому вы присоединяетесь,
       и примите (или отклоните) запрос.

    <span data-bind="if: joinreq">
      <br>Неподтвержденные запросы на присоединение:
      <table>
      <tbody data-bind="foreach: joinreq">
      <tr><td data-bind="html: html"></td>
          <td><input type=submit value="принять"
                     data-bind='click: function(data, event){ $parent.joinreq_accept($index)}'>
              <input type=submit value="отклонить"
                     data-bind='click: function(data, event){ $parent.joinreq_delete($index)}'>
          </td>
      </tr></tbody></table>
      <br>Будте внимательны, принимайте те запросы, которые вы
          отправляли, убедитесь, что это ваш аккаунт.
    </span>
    </font>
    </form>
  </span>

  <!-- User level -->
  <span data-bind="if: alias">
    <p>Ваш уровень доступа: <b data-bind="text: rlevel"></b>.
       Поменять ваш уровень доступа может пользователь с уровнем, большим, чем у вас.
    <br>Уровни доступа:
    <ul>
    <li>ограниченный -- те же права, что и у анонимного пользователя,
    <li>обычный -- любой новый пользователь,
    <li>модератор -- может править чужие записи и банить обычных пользователей,
    <li>администратор -- может назначать и свергать модераторов,
    <li>самый главный -- пользователь с самыми высокими правами.
    </ul>
  </span>

  <!-- User list -->
  <span data-bind='if: level() >= 2'>
    <h4>Список пользователей</h4>
    <p>Для просмотра списка требуется уровень доступа не ниже модерaтора.
    <input type=submit data-bind='click: sw_user_list, value: user_list_btn'>

    <p><table data-bind='visible: user_list' style="display: none"
        id="user_table" cellpadding=5 cellspacing=0 border=1>
    <thead><tr><th>пользователь</th><th>аккаунты</th><th>уровень</th></tr></thead>
    <tbody data-bind='foreach: users'>
      <tr>
      <td valign=top><b data-bind='text: alias'></b></td>
      <td valign=top data-bind="foreach: faces">
        <span data-bind="html: html"></span><br>
      </td>
      <td valign=top>
        <span data-bind="text: rlevel"></span>
        <span data-bind='if: level_hints().length > 0'>
        <img src="RESDIR/edit2.png" alt="изменить"
           data-bind='click: sw_level_form'>
        <form>
        <select style="display: none"
           data-bind="visible: level_form,
                      options: level_hints,
                      optionsText: 'rlevel',
                      optionsValue: 'level',
                      value: new_level,
                      event: {change: $parent.set_level}">
        </select>
        </form>
        </span>
      </td>
      </tr>
    </tbody>
    </table>
  </span>


</body>
</html>
