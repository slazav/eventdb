<html>
<head>
  <LINK href="eventdb/eventdb.css" rel="stylesheet" type="text/css">
  <script type="text/JavaScript" src="eventdb/eventdb.js"></script>
  <style>
    th {
      font-weight: normal;
      background-color: #D0F0FF;
    }
  </style>
</head>

<body>

  <table width="100%" border=0 class="main_menu"><tr>
  <td class=hh width="50%"><a href="main.htm">Главная</a></td>
  <td class=hh width="50%" align=right id=login_box></td>
  </tr></table>
  <hr>

  <h4>Добро пожаловать!</h4>

  <script>
    // open/close the set alias form
    // fill if with a current alias name
    function ch_alias_form(){
      var form = document.getElementById('ch_alias_form');
      form.value= document.getElementById('user_alias').innerHTML;
      form.style.display = form.style.display=="inline"? "none":"inline";
    }
    // ch_alias request + update all aliases on the page
    function ch_alias_do(){
      var newal = document.getElementById('ch_alias_form').value;
      do_request('set_alias ' + newal, function(my_info){
          a = document.getElementsByClassName('user_alias');
          for (var i=0; i < a.length; i++){ a[i].innerHTML = my_info.alias; }
        });
      ch_alias_form();
    }
  </script>

  <span class="name_block" style="display:none">
  <p>Вы -- <span class="user_identity"></span>,
     в социальных сетях про вас известно все!
  <p>Ваше имя на этом сайте:
     <b><span class="user_alias" id="user_alias"></span></b>
     <img src="http://slazav.mccme.ru/eventdb/edit2.png"
          onclick="ch_alias_form()" alt="редактировать">
     <input id="ch_alias_form" type="text" style="display:none"
            name="new_alias" onchange="ch_alias_do()"></span>.
  <br>Вы можете поменять имя, нажав на картинку справа от него.
  <br>Имя может содержать от 2 до 20 символов: буквы, цифры, символы подчеркивания "_"
  <br>(автоматически созданные имена содержат также знак "@").
  <br>Имя не может совпадать с именем другого пользователя.

  <p>Ваш уровень доступа: <span class="user_rlevel"></span>. Поменять ваш уровень
     доступа может пользователь с уровнем, большим, чем у вас.
  <br>Уровни доступа:
  <ul>
  <li>ограниченный -- те же права, что и у анонимного пользователя,
  <li>обычный -- любой новый пользователь,
  <li>модератор -- может править чужие записи и банить обычных пользователей,
  <li>администратор -- может назначать и свергать модераторов,
  <li>самый главный -- пользователь с самыми высокими правами.
  </ul>
  </span>

  <script>
    // print level form
    function level_form(user){
      ret = '<span id="level_' + user.alias + '">'
            + get_rlevel(user.level) + '</span>&nbsp;';
      if (user.level_hints){ ret = ret
           + '<img src="http://slazav.mccme.ru/eventdb/edit2.png"'
           + ' alt="редактировать"'
           + ' onclick="ch_level_form(\'' + user.alias + '\')"> '
           + '<select style="display:none"'
           + ' onchange="ch_level_do(\'' + user.alias + '\')"'
           + ' name="' + user.identity + '"'
           + ' id="level_form_' + user.alias + '">';
        for (var i in user.level_hints){
          var l = user.level_hints[i];
          ret = ret + '<option value="' + l + '"'
                    + (l==user.level? 'selected':'') + '>'
                    + get_rlevel(l) + '</option>';
        }
        ret = ret + '</select>';
      }
      return ret;
    }

    // open/close the level form
    // fill if with a current alias name
    function ch_level_form(alias){
      var form = document.getElementById('level_form_' + alias);
      form.style.display = form.style.display=="inline"? "none":"inline";
    }

    // ch_alias request + update all aliases on the page
    function ch_level_do(alias){
      var form = document.getElementById('level_form_' + alias);
      var id  = form.name;
      var lev = form.value;
      do_request('set_level "' + id + '" ' + lev, function(user){
        a = document.getElementById('level_' + user.alias);
        a.innerHTML = get_rlevel(user.level);
      });
      ch_level_form(alias);
    }

    function sh_users(){
      var tab = document.getElementById('user_table');
      var btn = document.getElementById('user_button');
      if (tab.style.display=="none"){
        do_request('user_list', function(users){
          var tab = document.getElementById('user_table');
          var btn = document.getElementById('user_button');
          btn.value="скрыть";
          tab.style.display="inline";
          tab.innerHTML='<tr><th>пользователь</th>'
                       +'    <th>имя на сайте</th>'
                       +'    <th>уровень</th>'
                       +'</tr>';
          for (var key in users){
            tab.innerHTML = tab.innerHTML
              + '<tr><td>' + user_identity(users[key]) + '</td>'
              + '<td><b>' + users[key].alias + '</b></td>'
              + '<td>' + level_form(users[key]) + '</td>'
              + '</tr>';
          }
        });
      }
      else {
        tab.style.display="none";
        btn.value="показать";
        tab.innerHTML="";
      }
    }
  </script>

  <span class="list_block" style="display:none">
  <h4>Список пользователей</h4>
  <input type=submit name="sh_users" value="показать"
         onclick="sh_users()" id="user_button">
  <p><table style="display:none" id="user_table" cellpadding=5 cellspacing=0 border=1>
  </table>
  </span>

  <script> do_init() </script>
</body>
</html>
